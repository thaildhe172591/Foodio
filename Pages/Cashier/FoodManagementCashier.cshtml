@page
@model FoodieAPII.Pages.Cashier.FoodManagementCashierModel
@{
    ViewData["HideLayoutHeader"] = true;
}

<div class="sticky-top bg-white shadow-sm px-4 py-2 d-flex align-items-center justify-content-between" style="z-index:1040;">
    <div class="d-flex align-items-center">
        <img src="~/images/logo_foddie.jpg" alt="GrabFood Logo" style="height: 60px; border-radius: 8px;">
        <div class="text-dark fw-bold fs-5 ms-3">
            Bàn Đặt số 
        </div>
    </div>
    <div class="header-search-button d-flex align-items-center gap-3">
        <input type="text" class="form-control" placeholder="Tìm món (F3)..." style="width: 300px;">
        <button class="btn btn-success rounded-circle d-flex justify-content-center align-items-center position-relative"
                style="width: 40px; height: 40px;">
            <a href="#cart-section"><i class="bi bi-cart3 fs-4 text-white"></i></a>
            <span id="cart-quantity-badge"
                  class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
                  style="font-size: 0.7em;">
                0
            </span>
        </button>
    </div>
</div>

<div class="container-fluid">
    <div class="row">
        <!-- LEFT: Mua sắm -->
        <div class="col-md-7" style="height: calc(100vh - 80px); overflow-y: auto;">
            <div class="container mt-3">
                <ul class="nav nav-tabs mb-3" id="menuTabs" role="tablist">
                    <li class="nav-item">
                        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#hot">Đồ nóng</button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#cold">Đồ mát</button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#drink">Nước</button>
                    </li>
                </ul>

                <div class="tab-content" style="height: calc(100vh - 200px); overflow-y: auto;">
                    <!-- Tab: Đồ nóng -->
                    <div class="tab-pane fade show active" id="hot">
                        <div class="row">
                            <div class="col-md-3 mb-4">
                                <div class="card text-center shadow-lg rounded-3 overflow-hidden h-100 position-relative">
                                    <img src="~/images/banner-1.jpg" class="card-img-top object-fit-cover" alt="Phở bò tái" style="height: 160px; object-fit: cover;">
                                    <div class="card-body p-3">
                                        <h6 class="card-title fw-bold">Phở bò tái</h6>
                                        <p class="fw-bold text-primary">45.000 ₫</p>
                                        <button class="btn btn-add-to-cart-custom add-to-cart-btn" data-product-id="001">
                                            <i class="bi bi-cart-plus"></i> Thêm vào giỏ
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tab: Đồ mát -->
                    <div class="tab-pane fade" id="cold">
                        <div class="row">
                            <div class="col-md-3 mb-4">
                                <div class="card text-center shadow-lg rounded-3 overflow-hidden h-100 position-relative">
                                    <img src="~/images/banner-1.jpg" class="card-img-top object-fit-cover" alt="Chè thái" style="height: 160px; object-fit: cover;">
                                    <div class="card-body p-3">
                                        <h6 class="card-title fw-bold">Chè thái sầu riêng</h6>
                                        <p class="fw-bold text-primary">25.000 ₫</p>
                                        <button class="btn btn-add-to-cart-custom add-to-cart-btn" data-product-id="002">
                                            <i class="bi bi-cart-plus"></i> Thêm vào giỏ
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tab: Nước -->
                    <div class="tab-pane fade" id="drink">
                        <div class="row">
                            <div class="col-md-3 mb-4">
                                <div class="card text-center shadow-lg rounded-3 overflow-hidden h-100 position-relative">
                                    <img src="~/images/banner-1.jpg" class="card-img-top object-fit-cover" alt="Trà đào" style="height: 160px; object-fit: cover;">
                                    <div class="card-body p-3">
                                        <h6 class="card-title fw-bold">Trà đào</h6>
                                        <p class="fw-bold text-primary">22.000 ₫</p>
                                        <button class="btn btn-add-to-cart-custom add-to-cart-btn" data-product-id="003">
                                            <i class="bi bi-cart-plus"></i> Thêm vào giỏ
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- RIGHT: Giỏ hàng -->
        <div class="col-md-5 bg-light" id="cart-section">
            <div class="p-4">
                <h2 class="mb-4">Giỏ Hàng của bạn</h2>
                <table class="table table-bordered table-striped">
                    <thead class="table-light">
                        <tr>
                            <th>Sản phẩm</th>
                            <th>Đơn giá</th>
                            <th class="text-center">Số lượng</th>
                            <th>Thành tiền</th>
                            <th>Ghi Chú</th>
                        </tr>
                    </thead>
                    <tbody id="cart-body">
                        <!-- Cart items will be dynamically inserted here -->
                    </tbody>
                    <tfoot>
                        <tr>
                            <th colspan="3" class="text-end">Tổng cộng:</th>
                            <th id="cart-total">0 ₫</th>
                        </tr>
                    </tfoot>
                </table>
                <a href="/Cashier/PayBillCashier" class="btn btn-primary ms-2">Thanh toán</a>
                
            </div>
        </div>
    </div>
</div>

<!-- Modal Xác nhận với ghi chú -->
<div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmModalLabel">Xác nhận gửi đơn</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Bạn chắc chắn muốn gửi đơn đến bếp không?
                <textarea class="form-control mt-3" id="orderNotes" rows="4" placeholder="Ghi chú cho bếp..."></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" id="confirmSubmit">Xác nhận</button>
            </div>
        </div>
    </div>
</div>

<!-- Styles -->
<style>
    .btn-add-to-cart-custom {
        background: linear-gradient(90deg, #ffbf2f, #ff9e3e);
        color: #222;
        border: none;
        border-radius: 22px;
        font-weight: 600;
        font-size: 14px;
        padding: 7px 20px 7px 15px;
        box-shadow: 0 3px 12px 0 rgba(255, 190, 50, 0.13);
        display: inline-flex;
        align-items: center;
        gap: 5px;
        transition: background 0.2s, color 0.2s, box-shadow 0.2s, transform 0.18s;
        text-decoration: none;
        cursor: pointer;
    }

        .btn-add-to-cart-custom:hover {
            background: linear-gradient(90deg, #ffc107, #ff8800);
            color: #fff !important;
            box-shadow: 0 6px 20px 0 rgba(255, 180, 30, 0.18);
            transform: translateY(-2px) scale(1.04);
        }

    .card {
        transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
    }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

    /* Giỏ hàng */
    .table th, .table td {
        vertical-align: middle;
    }

    .table-striped tbody tr:nth-of-type(odd) {
        background-color: #f9f9f9;
    }

    .table-bordered th, .table-bordered td {
        border: 1px solid #ddd;
    }

    #cart-total {
        font-weight: bold;
        font-size: 1.2em;
    }

</style>

<!-- Script -->
@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const cartBody = document.getElementById('cart-body');
            const cartTotal = document.getElementById('cart-total');
            const completeOrderButton = document.getElementById('completeOrderButton');
            const confirmModal = new bootstrap.Modal(document.getElementById('confirmModal'));
            const orderNotesInput = document.getElementById('orderNotes');

            let cart = [];

            document.querySelectorAll('.add-to-cart-btn').forEach(button => {
                button.addEventListener('click', function () {
                    const productId = this.getAttribute('data-product-id');
                    const productName = this.closest('.card').querySelector('.card-title').textContent;
                    const productPrice = parseInt(this.closest('.card').querySelector('.fw-bold.text-primary').textContent.replace(/[^\d]/g, ''));

                    let product = cart.find(item => item.id === productId);

                    if (product) {
                        product.qty++;
                    } else {
                        product = {
                            id: productId,
                            name: productName,
                            price: productPrice,
                            qty: 1
                        };
                        cart.push(product);
                    }

                    updateCart();
                });
            });

            function updateCart() {
                cartBody.innerHTML = '';
                let total = 0;

                cart.forEach(item => {
                    const row = document.createElement('tr');
                    row.setAttribute('data-id', item.id);
                    row.innerHTML = `
                        <td>${item.name}</td>
                        <td class="price">${item.price}</td>
                        <td class="text-center">
                            <button class="btn btn-sm btn-danger btn-decrease">–</button>
                            <span class="qty mx-2">${item.qty}</span>
                            <button class="btn btn-sm btn-success btn-increase">+</button>
                        </td>
                        <td class="subtotal">${(item.qty * item.price).toLocaleString('vi-VN')} ₫</td>
                        <td><button class="btn btn-sm btn-danger btn-remove">Xóa</button></td>
                    `;
                    cartBody.appendChild(row);

                    total += item.qty * item.price;
                });

                cartTotal.textContent = total.toLocaleString('vi-VN') + ' ₫';
            }

            cartBody.addEventListener('click', function (e) {
                const row = e.target.closest('tr');
                if (!row) return;

                const productId = row.getAttribute('data-id');
                const product = cart.find(item => item.id === productId);
                const qtySpan = row.querySelector('.qty');
                const subtotalCell = row.querySelector('.subtotal');

                if (e.target.classList.contains('btn-increase')) {
                    product.qty++;
                } else if (e.target.classList.contains('btn-decrease')) {
                    product.qty = Math.max(1, product.qty - 1);
                } else if (e.target.classList.contains('btn-remove')) {
                    cart = cart.filter(item => item.id !== productId);
                }

                qtySpan.textContent = product.qty;
                subtotalCell.textContent = (product.qty * product.price).toLocaleString('vi-VN') + ' ₫';

                updateCart();
            });

            completeOrderButton.addEventListener('click', function (e) {
                e.preventDefault(); // Prevent default form submit
                confirmModal.show(); // Show confirmation modal
            });

            document.getElementById('confirmSubmit').addEventListener('click', function () {
                const orderNotes = orderNotesInput.value; // Get notes
                // You can pass this data to the backend to save if needed
                alert('Đơn đã được gửi đến bếp với ghi chú: ' + orderNotes);
                // Redirect to the OrderStatus page
                window.location.href = '/Offline/OrderStatus'; // Change the redirection link to your desired page
            });
        });
    </script>
}